<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinGuardian - Your Financial Wellness Guardian</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .light-bg {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f1f5f9 100%);
        }
        
        .accent-pattern {
            background-image: 
                radial-gradient(circle at 25% 25%, #ddd6fe 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, #fce7f3 0%, transparent 50%);
        }
        
        .modern-gradient {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .clean-card {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(226, 232, 240, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .stat-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
        }

        .input-focus {
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); /* Indigo-50 */
        }

        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .slide-in {
            animation: slideIn 0.8s ease-out forwards;
        }

        @keyframes slideIn {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0px); opacity: 1; }
        }

        .chart-interactive {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chart-interactive:hover {
            transform: scale(1.02);
        }
        
        .insight-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-left: 4px solid #6366f1;
            transition: all 0.3s ease;
        }
        
        .insight-card:hover {
            border-left-color: #8b5cf6;
            transform: translateX(4px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Mock API and Data Management
        const mockApi = {
            users: JSON.parse(localStorage.getItem('finguardian_users') || '[]'),
            transactions: JSON.parse(localStorage.getItem('finguardian_transactions') || '[]'),
            emis: JSON.parse(localStorage.getItem('finguardian_emis') || '[]'),
            goals: JSON.parse(localStorage.getItem('finguardian_goals') || '[]'),
            nudges: JSON.parse(localStorage.getItem('finguardian_nudges') || '[]'),
            
            saveData() {
                localStorage.setItem('finguardian_users', JSON.stringify(this.users));
                localStorage.setItem('finguardian_transactions', JSON.stringify(this.transactions));
                localStorage.setItem('finguardian_emis', JSON.stringify(this.emis));
                localStorage.setItem('finguardian_goals', JSON.stringify(this.goals));
                localStorage.setItem('finguardian_nudges', JSON.stringify(this.nudges));
            },

            login(email, password) {
                const user = this.users.find(u => u.email === email && u.password === password);
                if (user) {
                    const token = btoa(JSON.stringify({ userId: user.id, email: user.email }));
                    return { success: true, token, user };
                }
                return { success: false, message: 'Invalid credentials' };
            },

            register(name, email, password) {
                if (this.users.find(u => u.email === email)) {
                    return { success: false, message: 'Email already exists' };
                }
                const user = {
                    id: Date.now(),
                    name,
                    email,
                    password,
                    created_at: new Date().toISOString()
                };
                this.users.push(user);
                this.saveData();
                return { success: true, user };
            },

            getUserTransactions(userId) {
                return this.transactions.filter(t => t.user_id === userId);
            },

            addTransaction(userId, transaction) {
                const newTransaction = {
                    id: Date.now(),
                    user_id: userId,
                    ...transaction,
                    created_at: new Date().toISOString()
                };
                this.transactions.push(newTransaction);
                this.saveData();
                return newTransaction;
            },

            addEMI(userId, emi) {
                const newEMI = {
                    id: Date.now(),
                    user_id: userId,
                    ...emi,
                    created_at: new Date().toISOString()
                };
                this.emis.push(newEMI);
                this.saveData();
                return newEMI;
            },

            addGoal(userId, goal) {
                const newGoal = {
                    id: Date.now(),
                    user_id: userId,
                    ...goal,
                    created_at: new Date().toISOString()
                };
                this.goals.push(newGoal);
                this.saveData();
                return newGoal;
            },

            getUserEMIs(userId) {
                return this.emis.filter(e => e.user_id === userId);
            },

            getUserGoals(userId) {
                return this.goals.filter(g => g.user_id === userId);
            },

            getUserNudges(userId) {
                return this.nudges.filter(n => n.user_id === userId).slice(-5);
            }
        };

        // Transaction Categorizer
        const categorizeTransaction = (description, amount) => {
            const desc = description.toLowerCase();
            const categories = {
                'Food & Dining': ['zomato', 'swiggy', 'restaurant', 'food', 'cafe', 'pizza', 'dominos', 'kfc'],
                'Transportation': ['uber', 'ola', 'taxi', 'metro', 'bus', 'petrol', 'fuel', 'parking'],
                'Shopping': ['amazon', 'flipkart', 'myntra', 'shopping', 'mall', 'store', 'purchase'],
                'Bills & Utilities': ['electricity', 'water', 'gas', 'internet', 'mobile', 'recharge', 'bill'],
                'Entertainment': ['netflix', 'spotify', 'movie', 'cinema', 'game', 'subscription'],
                'Healthcare': ['hospital', 'pharmacy', 'medical', 'doctor', 'health'],
                'EMI': ['emi', 'loan', 'credit'],
                'Investment': ['mutual fund', 'sip', 'investment', 'stock'],
                'Transfer': ['transfer', 'upi', 'neft', 'imps']
            };

            for (const [category, keywords] of Object.entries(categories)) {
                if (keywords.some(keyword => desc.includes(keyword))) {
                    return category;
                }
            }
            return amount < 0 ? 'Others' : 'Income';
        };

        // Financial Wellness Calculator
        const calculateWellnessScore = (transactions, emis, income = 50000) => {
            const monthlyExpenses = transactions
                .filter(t => t.amount < 0 && t.category !== 'Investment' && t.category !== 'Transfer')
                .reduce((sum, t) => sum + Math.abs(t.amount), 0);
            
            const monthlyEMIs = emis.reduce((sum, e) => sum + e.monthly_emi, 0);
            const savings = income - monthlyExpenses - monthlyEMIs;
            
            const savingsRate = (savings / income) * 100;
            const emiBurden = (monthlyEMIs / income) * 100;
            const expenseRatio = (monthlyExpenses / income) * 100;

            let score = 100;
            
            // Deduct points based on financial health metrics
            if (savingsRate < 20) score -= (20 - savingsRate) * 2;
            if (emiBurden > 40) score -= (emiBurden - 40) * 2;
            if (expenseRatio > 60) score -= (expenseRatio - 60) * 1.5;

            return Math.max(0, Math.min(100, Math.round(score)));
        };

        // Generate AI Nudges
        const generateNudges = (userId, transactions, emis, income = 50000) => {
            const nudges = [];
            
            // Food spending analysis
            const foodSpending = transactions
                .filter(t => t.category === 'Food & Dining' && t.amount < 0)
                .reduce((sum, t) => sum + Math.abs(t.amount), 0);
            
            if (foodSpending > income * 0.15) {
                nudges.push({
                    id: Date.now() + Math.random(),
                    user_id: userId,
                    message: `Your food delivery spends are ‚Çπ${foodSpending.toLocaleString()}, which is ${((foodSpending/income)*100).toFixed(1)}% of income. Consider cooking more at home!`,
                    severity: 'warning',
                    context: 'spending',
                    created_at: new Date().toISOString()
                });
            }

            // EMI burden check
            const totalEMI = emis.reduce((sum, e) => sum + e.monthly_emi, 0);
            if (totalEMI > income * 0.4) {
                nudges.push({
                    id: Date.now() + Math.random(),
                    user_id: userId,
                    message: `Your EMI burden is ‚Çπ${totalEMI.toLocaleString()} (${((totalEMI/income)*100).toFixed(1)}% of income). This is above the safe limit of 40%.`,
                    severity: 'danger',
                    context: 'emi',
                    created_at: new Date().toISOString()
                });
            }

            // Savings rate check
            const expenses = transactions
                .filter(t => t.amount < 0 && t.category !== 'Investment')
                .reduce((sum, t) => sum + Math.abs(t.amount), 0);
            const savings = income - expenses - totalEMI;
            
            if (savings < income * 0.2) {
                nudges.push({
                    id: Date.now() + Math.random(),
                    user_id: userId,
                    message: `Your monthly savings rate is only ${((savings/income)*100).toFixed(1)}%. Try to save at least 20% of your income.`,
                    severity: 'info',
                    context: 'savings',
                    created_at: new Date().toISOString()
                });
            }

            // Update nudges in mock API
            mockApi.nudges = mockApi.nudges.filter(n => n.user_id !== userId);
            mockApi.nudges.push(...nudges);
            mockApi.saveData();

            return nudges;
        };

        // Authentication Hook
        const useAuth = () => {
            const [user, setUser] = useState(null);
            const [token, setToken] = useState(localStorage.getItem('finguardian_token'));

            useEffect(() => {
                if (token) {
                    try {
                        const decoded = JSON.parse(atob(token));
                        const userData = mockApi.users.find(u => u.id === decoded.userId);
                        setUser(userData);
                    } catch (error) {
                        localStorage.removeItem('finguardian_token');
                        setToken(null);
                    }
                }
            }, [token]);

            const login = (email, password) => {
                const result = mockApi.login(email, password);
                if (result.success) {
                    localStorage.setItem('finguardian_token', result.token);
                    setToken(result.token);
                    setUser(result.user);
                }
                return result;
            };

            const register = (name, email, password) => {
                return mockApi.register(name, email, password);
            };

            const logout = () => {
                localStorage.removeItem('finguardian_token');
                setToken(null);
                setUser(null);
            };

            return { user, login, register, logout };
        };

        // Login Component
        const Login = ({ onLogin, onSwitchToRegister }) => {
            const [formData, setFormData] = useState({ email: '', password: '' });
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                const result = onLogin(formData.email, formData.password);
                if (!result.success) {
                    setError(result.message);
                }
            };

            return (
                <div className="min-h-screen light-bg accent-pattern flex items-center justify-center p-4">
                    <div className="clean-card rounded-3xl shadow-xl p-8 w-full max-w-md slide-in">
                        <div className="text-center mb-8">
                            <div className="floating-animation">
                                <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center">
                                    <span className="text-2xl text-white">üí∞</span>
                                </div>
                            </div>
                            <h1 className="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2">
                                FinGuardian
                            </h1>
                            <p className="text-gray-600 font-medium">Your Financial Wellness Guardian</p>
                        </div>
                        
                        {error && (
                            <div className="bg-red-50 border-l-4 border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6 slide-in">
                                <div className="flex items-center">
                                    <span className="mr-2">‚ö†Ô∏è</span>
                                    {error}
                                </div>
                            </div>
                        )}

                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div>
                                <label className="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                                <input
                                    type="email"
                                    required
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all input-focus"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    placeholder="Enter your email"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-semibold text-gray-700 mb-2">Password</label>
                                <input
                                    type="password"
                                    required
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all input-focus"
                                    value={formData.password}
                                    onChange={(e) => setFormData({...formData, password: e.target.value})}
                                    placeholder="Enter your password"
                                />
                            </div>

                            <button
                                type="submit"
                                className="w-full btn-primary text-white py-3 rounded-xl font-semibold text-lg"
                            >
                                Sign In
                            </button>
                        </form>

                        <p className="text-center mt-6 text-gray-600">
                            Don't have an account?{' '}
                            <button
                                onClick={onSwitchToRegister}
                                className="text-indigo-600 hover:text-indigo-800 font-semibold"
                            >
                                Sign Up
                            </button>
                        </p>
                    </div>
                </div>
            );
        };

        // Register Component
        const Register = ({ onRegister, onSwitchToLogin }) => {
            const [formData, setFormData] = useState({ name: '', email: '', password: '' });
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                const result = onRegister(formData.name, formData.email, formData.password);
                if (result.success) {
                    onSwitchToLogin();
                } else {
                    setError(result.message);
                }
            };

            return (
                <div className="min-h-screen light-bg accent-pattern flex items-center justify-center p-4">
                    <div className="clean-card rounded-3xl shadow-xl p-8 w-full max-w-md slide-in">
                        <div className="text-center mb-8">
                            <div className="floating-animation">
                                <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center">
                                    <span className="text-2xl text-white">üí∞</span>
                                </div>
                            </div>
                            <h1 className="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2">
                                Join FinGuardian
                            </h1>
                            <p className="text-gray-600 font-medium">Start your financial wellness journey</p>
                        </div>
                        
                        {error && (
                            <div className="bg-red-50 border-l-4 border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6 slide-in">
                                <div className="flex items-center">
                                    <span className="mr-2">‚ö†Ô∏è</span>
                                    {error}
                                </div>
                            </div>
                        )}

                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div>
                                <label className="block text-sm font-semibold text-gray-700 mb-2">Full Name</label>
                                <input
                                    type="text"
                                    required
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all input-focus"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    placeholder="Enter your full name"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                                <input
                                    type="email"
                                    required
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all input-focus"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    placeholder="Enter your email"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-semibold text-gray-700 mb-2">Password</label>
                                <input
                                    type="password"
                                    required
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all input-focus"
                                    value={formData.password}
                                    onChange={(e) => setFormData({...formData, password: e.target.value})}
                                    placeholder="Enter your password"
                                />
                            </div>

                            <button
                                type="submit"
                                className="w-full btn-primary text-white py-3 rounded-xl font-semibold text-lg"
                            >
                                Create Account
                            </button>
                        </form>

                        <p className="text-center mt-6 text-gray-600">
                            Already have an account?{' '}
                            <button
                                onClick={onSwitchToLogin}
                                className="text-indigo-600 hover:text-indigo-800 font-semibold"
                            >
                                Sign In
                            </button>
                        </p>
                    </div>
                </div>
            );
        };

        // Dashboard Cards
        const StatCard = ({ title, value, subtitle, icon, color = 'blue', trend = null }) => (
            <div className={`stat-card rounded-2xl shadow-lg p-6 card-hover border-l-4 ${color === 'green' ? 'border-green-500' : color === 'red' ? 'border-red-500' : color === 'yellow' ? 'border-yellow-500' : 'border-blue-500'}`}>
                <div className="flex items-center justify-between">
                    <div>
                        <p className="text-sm font-medium text-gray-600">{title}</p>
                        <p className="text-2xl font-bold text-gray-900 mt-1">{value}</p>
                        {subtitle && <p className="text-sm text-gray-500 mt-1">{subtitle}</p>}
                    </div>
                    <div className={`${color === 'green' ? 'text-green-500' : color === 'red' ? 'text-red-500' : color === 'yellow' ? 'text-yellow-500' : 'text-blue-500'} text-4xl`}>{icon}</div>
                </div>
                {trend && (
                    <div className={`mt-3 flex items-center text-sm ${trend.positive ? 'text-green-600' : 'text-red-600'}`}>
                        <span>{trend.positive ? '‚Üó' : '‚Üò'}</span>
                        <span className="ml-1">{trend.value}</span>
                    </div>
                )}
            </div>
        );

        // Nudge Card
        const NudgeCard = ({ nudge, onDismiss }) => {
            const severityColors = {
                info: 'border-blue-200 bg-blue-50 text-blue-800',
                warning: 'border-yellow-200 bg-yellow-50 text-yellow-800',
                danger: 'border-red-200 bg-red-50 text-red-800'
            };

            const severityIcons = {
                info: 'üí°',
                warning: '‚ö†Ô∏è',
                danger: 'üö®'
            };

            return (
                <div className={`rounded-lg border p-4 mb-3 ${severityColors[nudge.severity]}`}>
                    <div className="flex items-start justify-between">
                        <div className="flex">
                            <span className="mr-3 text-lg">{severityIcons[nudge.severity]}</span>
                            <div>
                                <p className="font-medium text-sm">{nudge.message}</p>
                                <p className="text-xs opacity-75 mt-1">
                                    {new Date(nudge.created_at).toLocaleDateString()}
                                </p>
                            </div>
                        </div>
                        <button
                            onClick={() => onDismiss(nudge.id)}
                            className="text-gray-400 hover:text-gray-600 ml-2"
                        >
                            √ó
                        </button>
                    </div>
                </div>
            );
        };

        // Chart Component
        const ExpenseChart = ({ transactions }) => {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            const [selectedCategory, setSelectedCategory] = useState(null);
            const [insights, setInsights] = useState([]);

            const generateInsights = (categoryData, transactions) => {
                const insights = [];
                const totalExpense = Object.values(categoryData).reduce((sum, val) => sum + val, 0);
                
                const highestCategory = Object.entries(categoryData).reduce((max, [cat, amount]) => 
                    amount > max.amount ? { category: cat, amount } : max, { category: '', amount: 0 });
                
                if (highestCategory.amount > 0) {
                    const percentage = ((highestCategory.amount / totalExpense) * 100).toFixed(1);
                    insights.push({
                        type: 'warning',
                        title: 'Highest Spending Category',
                        message: `${highestCategory.category} accounts for ${percentage}% of your expenses (‚Çπ${highestCategory.amount.toFixed(2)})`
                    });
                }
                
                const recentTransactions = transactions
                    .filter(t => t.amount < 0)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 5);
                
                const avgRecentExpense = recentTransactions.length > 0 ? recentTransactions.reduce((sum, t) => sum + Math.abs(t.amount), 0) / recentTransactions.length : 0;
                
                if (avgRecentExpense > 1000) {
                    insights.push({
                        type: 'info',
                        title: 'Recent Spending Pattern',
                        message: `Your average recent expense is ‚Çπ${avgRecentExpense.toFixed(2)}. Consider reviewing large purchases.`
                    });
                }
                
                const monthlyExpense = totalExpense;
                if (monthlyExpense > 15000) {
                    insights.push({
                        type: 'tip',
                        title: 'Budget Optimization',
                        message: `Monthly expenses: ‚Çπ${monthlyExpense.toFixed(2)}. Try the 50-30-20 rule: 50% needs, 30% wants, 20% savings.`
                    });
                }
                
                return insights;
            };

            useEffect(() => {
                if (!chartRef.current) return;

                const categoryData = {};
                transactions
                    .filter(t => t.amount < 0 && t.category !== 'Transfer')
                    .forEach(t => {
                        categoryData[t.category] = (categoryData[t.category] || 0) + Math.abs(t.amount);
                    });

                const labels = Object.keys(categoryData);
                const data = Object.values(categoryData);
                
                setInsights(generateInsights(categoryData, transactions));

                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                const ctx = chartRef.current.getContext('2d');
                chartInstance.current = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels,
                        datasets: [{
                            data,
                            backgroundColor: [
                                '#6366f1', '#8b5cf6', '#ec4899', '#f59e0b',
                                '#10b981', '#ef4444', '#14b8a6', '#f97316'
                            ],
                            borderWidth: 3,
                            borderColor: '#fff',
                            hoverBorderWidth: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: {
                                        size: 12,
                                        weight: '600'
                                    }
                                }
                            }
                        },
                        cutout: '60%',
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const index = elements[0].index;
                                const category = labels[index];
                                const amount = data[index];
                                setSelectedCategory({ category, amount, percentage: ((amount / data.reduce((a, b) => a + b, 0)) * 100).toFixed(1) });
                            }
                        }
                    }
                });
            }, [transactions]);

            return (
                <div className="space-y-6">
                    <div className="bg-white rounded-2xl shadow-lg p-6 card-hover chart-interactive">
                        <h3 className="text-xl font-bold text-gray-800 mb-6 flex items-center">
                            <span className="mr-2">üìä</span>
                            Interactive Expense Breakdown
                            {selectedCategory && (
                                <span className="ml-auto text-sm font-normal text-gray-600">
                                    Click segments for details
                                </span>
                            )}
                        </h3>
                        <div style={{ height: '300px' }}>
                            <canvas ref={chartRef}></canvas>
                        </div>
                        
                        {selectedCategory && (
                            <div className="mt-4 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border border-indigo-200">
                                <h4 className="font-semibold text-indigo-800">{selectedCategory.category}</h4>
                                <p className="text-indigo-600">
                                    Amount: ‚Çπ{selectedCategory.amount.toFixed(2)} ({selectedCategory.percentage}% of total expenses)
                                </p>
                            </div>
                        )}
                    </div>
                    
                    <div className="space-y-3">
                        <h4 className="text-lg font-semibold text-gray-800 flex items-center">
                            <span className="mr-2">üí°</span>
                            Smart Insights
                        </h4>
                        {insights.map((insight, index) => (
                            <div key={index} className={`insight-card p-4 rounded-xl ${
                                insight.type === 'warning' ? 'border-l-orange-400 bg-orange-50' :
                                insight.type === 'info' ? 'border-l-blue-400 bg-blue-50' :
                                'border-l-green-400 bg-green-50'
                            }`}>
                                <h5 className="font-semibold text-gray-800 mb-1">{insight.title}</h5>
                                <p className="text-gray-600 text-sm">{insight.message}</p>
                            </div>
                        ))}
                        {insights.length === 0 && (
                            <div className="insight-card p-4 rounded-xl bg-gray-50">
                                <p className="text-gray-600 text-sm">Add more transactions to see personalized insights!</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Transaction Form
        const TransactionForm = ({ onSubmit, onClose }) => {
            const [formData, setFormData] = useState({
                date: new Date().toISOString().split('T')[0],
                amount: '',
                description: '',
                category: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                const category = formData.category || categorizeTransaction(formData.description, parseFloat(formData.amount));
                onSubmit({
                    ...formData,
                    amount: parseFloat(formData.amount),
                    category
                });
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-xl p-6 w-full max-w-md">
                        <h2 className="text-xl font-semibold mb-4">Add Transaction</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                <input
                                    type="date"
                                    required
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.date}
                                    onChange={(e) => setFormData({...formData, date: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Amount (‚Çπ)</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    required
                                    placeholder="Use negative for expenses"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.amount}
                                    onChange={(e) => setFormData({...formData, amount: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <input
                                    type="text"
                                    required
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.description}
                                    onChange={(e) => setFormData({...formData, description: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Category (optional)</label>
                                <select
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.category}
                                    onChange={(e) => setFormData({...formData, category: e.target.value})}
                                >
                                    <option value="">Auto-categorize</option>
                                    <option value="Food & Dining">Food & Dining</option>
                                    <option value="Transportation">Transportation</option>
                                    <option value="Shopping">Shopping</option>
                                    <option value="Bills & Utilities">Bills & Utilities</option>
                                    <option value="Entertainment">Entertainment</option>
                                    <option value="Healthcare">Healthcare</option>
                                    <option value="EMI">EMI</option>
                                    <option value="Investment">Investment</option>
                                    <option value="Income">Income</option>
                                    <option value="Others">Others</option>
                                </select>
                            </div>
                            <div className="flex space-x-3 pt-4">
                                <button
                                    type="submit"
                                    className="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition"
                                >
                                    Add Transaction
                                </button>
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition"
                                >
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // EMI Form
        const EMIForm = ({ onSubmit, onClose }) => {
            const [formData, setFormData] = useState({
                lender: '',
                monthly_emi: '',
                start_date: new Date().toISOString().split('T')[0],
                end_date: '',
                outstanding: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSubmit({
                    ...formData,
                    monthly_emi: parseFloat(formData.monthly_emi),
                    outstanding: parseFloat(formData.outstanding)
                });
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-xl p-6 w-full max-w-md">
                        <h2 className="text-xl font-semibold mb-4">Add EMI</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Lender</label>
                                <input
                                    type="text"
                                    required
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.lender}
                                    onChange={(e) => setFormData({...formData, lender: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Monthly EMI (‚Çπ)</label>
                                <input
                                    type="number"
                                    required
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.monthly_emi}
                                    onChange={(e) => setFormData({...formData, monthly_emi: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                                <input
                                    type="date"
                                    required
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.start_date}
                                    onChange={(e) => setFormData({...formData, start_date: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                                <input
                                    type="date"
                                    required
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.end_date}
                                    onChange={(e) => setFormData({...formData, end_date: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Outstanding Amount (‚Çπ)</label>
                                <input
                                    type="number"
                                    required
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.outstanding}
                                    onChange={(e) => setFormData({...formData, outstanding: e.target.value})}
                                />
                            </div>
                            <div className="flex space-x-3 pt-4">
                                <button
                                    type="submit"
                                    className="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition"
                                >
                                    Add EMI
                                </button>
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition"
                                >
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Goal Form
        const GoalForm = ({ onSubmit, onClose }) => {
            const [formData, setFormData] = useState({
                title: '',
                target_amount: '',
                current_amount: '',
                target_date: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSubmit({
                    ...formData,
                    target_amount: parseFloat(formData.target_amount),
                    current_amount: parseFloat(formData.current_amount) || 0
                });
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-xl p-6 w-full max-w-md">
                        <h2 className="text-xl font-semibold mb-4">Create Financial Goal</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Goal Title</label>
                                <input
                                    type="text"
                                    required
                                    placeholder="e.g., Emergency Fund, Vacation, New Car"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.title}
                                    onChange={(e) => setFormData({...formData, title: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Target Amount (‚Çπ)</label>
                                <input
                                    type="number"
                                    required
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.target_amount}
                                    onChange={(e) => setFormData({...formData, target_amount: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Current Amount (‚Çπ)</label>
                                <input
                                    type="number"
                                    placeholder="0"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.current_amount}
                                    onChange={(e) => setFormData({...formData, current_amount: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Target Date</label>
                                <input
                                    type="date"
                                    required
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={formData.target_date}
                                    onChange={(e) => setFormData({...formData, target_date: e.target.value})}
                                />
                            </div>
                            <div className="flex space-x-3 pt-4">
                                <button
                                    type="submit"
                                    className="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition"
                                >
                                    Create Goal
                                </button>
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition"
                                >
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Simulation Tool
        const SimulationModal = ({ onClose, currentIncome = 50000, transactions, emis }) => {
            const [newEMI, setNewEMI] = useState({ amount: '', duration: '' });
            const [simulationResult, setSimulationResult] = useState(null);

            const handleSimulate = () => {
                const emiAmount = parseFloat(newEMI.amount);
                const currentTotalEMI = emis.reduce((sum, e) => sum + e.monthly_emi, 0);
                const newTotalEMI = currentTotalEMI + emiAmount;
                
                const monthlyExpenses = transactions
                    .filter(t => t.amount < 0 && t.category !== 'Investment' && t.category !== 'Transfer')
                    .reduce((sum, t) => sum + Math.abs(t.amount), 0);
                
                const newSavings = currentIncome - monthlyExpenses - newTotalEMI;
                const newEMIBurden = (newTotalEMI / currentIncome) * 100;
                const newSavingsRate = (newSavings / currentIncome) * 100;
                
                let newScore = 100;
                if (newSavingsRate < 20) newScore -= (20 - newSavingsRate) * 2;
                if (newEMIBurden > 40) newScore -= (newEMIBurden - 40) * 2;
                
                const currentScore = calculateWellnessScore(transactions, emis, currentIncome);
                
                setSimulationResult({
                    currentScore,
                    newScore: Math.max(0, Math.round(newScore)),
                    emiImpact: emiAmount,
                    newTotalEMI,
                    newSavings,
                    newEMIBurden: newEMIBurden.toFixed(1),
                    recommendation: newEMIBurden > 40 ? 'Not Recommended - EMI burden too high' : 
                                   newSavingsRate < 10 ? 'Risky - Very low savings rate' :
                                   newSavingsRate < 20 ? 'Caution - Below recommended savings' : 'Safe to proceed'
                });
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-xl p-6 w-full max-w-lg">
                        <h2 className="text-xl font-semibold mb-4">EMI Impact Simulator</h2>
                        
                        <div className="space-y-4 mb-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">New EMI Amount (‚Çπ/month)</label>
                                <input
                                    type="number"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={newEMI.amount}
                                    onChange={(e) => setNewEMI({...newEMI, amount: e.target.value})}
                                    placeholder="Enter monthly EMI amount"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Duration (months)</label>
                                <input
                                    type="number"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    value={newEMI.duration}
                                    onChange={(e) => setNewEMI({...newEMI, duration: e.target.value})}
                                    placeholder="Loan duration in months"
                                />
                            </div>
                            <button
                                onClick={handleSimulate}
                                disabled={!newEMI.amount}
                                className="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition disabled:bg-gray-400"
                            >
                                Simulate Impact
                            </button>
                        </div>

                        {simulationResult && (
                            <div className="bg-gray-50 rounded-lg p-4 mb-4">
                                <h3 className="font-semibold mb-3">Simulation Results</h3>
                                <div className="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <p className="text-gray-600">Current Wellness Score</p>
                                        <p className="font-semibold text-lg">{simulationResult.currentScore}/100</p>
                                    </div>
                                    <div>
                                        <p className="text-gray-600">New Wellness Score</p>
                                        <p className={`font-semibold text-lg ${simulationResult.newScore >= simulationResult.currentScore ? 'text-green-600' : 'text-red-600'}`}>
                                            {simulationResult.newScore}/100
                                        </p>
                                    </div>
                                    <div>
                                        <p className="text-gray-600">Total EMI Burden</p>
                                        <p className="font-semibold">{simulationResult.newEMIBurden}%</p>
                                    </div>
                                    <div>
                                        <p className="text-gray-600">New Monthly Savings</p>
                                        <p className="font-semibold">‚Çπ{simulationResult.newSavings.toLocaleString()}</p>
                                    </div>
                                </div>
                                <div className={`mt-4 p-3 rounded-lg ${simulationResult.recommendation.includes('Not Recommended') ? 'bg-red-100 text-red-800' : simulationResult.recommendation.includes('Risky') ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}`}>
                                    <p className="font-medium">Recommendation: {simulationResult.recommendation}</p>
                                </div>
                            </div>
                        )}

                        <div className="flex space-x-3">
                            <button
                                onClick={onClose}
                                className="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition"
                            >
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // CSV Upload Component
        const CSVUpload = ({ onUpload, onClose }) => {
            const [dragOver, setDragOver] = useState(false);
            
            const handleFileUpload = (file) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const transactions = [];
                    
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line) continue;
                        
                        const cols = line.split(',').map(col => col.replace(/"/g, ''));
                        if (cols.length >= 3) {
                            const [date, description, amount] = cols;
                            const parsedAmount = parseFloat(amount);
                            if (!isNaN(parsedAmount)) {
                                transactions.push({
                                    date: date || new Date().toISOString().split('T')[0],
                                    description: description || 'Unknown transaction',
                                    amount: parsedAmount,
                                    category: categorizeTransaction(description, parsedAmount)
                                });
                            }
                        }
                    }
                    onUpload(transactions);
                };
                reader.readAsText(file);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);
                const file = e.dataTransfer.files[0];
                if (file && file.type === 'text/csv') {
                    handleFileUpload(file);
                }
            };

            const handleFileInput = (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFileUpload(file);
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-xl p-6 w-full max-w-md">
                        <h2 className="text-xl font-semibold mb-4">Upload Bank Statement</h2>
                        <div
                            className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${dragOver ? 'border-blue-400 bg-blue-50' : 'border-gray-300'}`}
                            onDragOver={(e) => { e.preventDefault(); setDragOver(true); }}
                            onDragLeave={() => setDragOver(false)}
                            onDrop={handleDrop}
                        >
                            <div className="text-4xl mb-4">üìÅ</div>
                            <p className="text-gray-600 mb-4">
                                Drag and drop your CSV file here, or click to browse
                            </p>
                            <input
                                type="file"
                                accept=".csv"
                                onChange={handleFileInput}
                                className="hidden"
                                id="csvInput"
                            />
                            <label
                                htmlFor="csvInput"
                                className="bg-blue-600 text-white px-4 py-2 rounded-lg cursor-pointer hover:bg-blue-700 transition"
                            >
                                Choose File
                            </label>
                            <p className="text-xs text-gray-500 mt-3">
                                Expected format: Date, Description, Amount
                            </p>
                        </div>
                        <div className="flex justify-end mt-4">
                            <button
                                onClick={onClose}
                                className="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition"
                            >
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Main Dashboard Component
        const Dashboard = ({ user, onLogout }) => {
            const [transactions, setTransactions] = useState([]);
            const [emis, setEMIs] = useState([]);
            const [goals, setGoals] = useState([]);
            const [nudges, setNudges] = useState([]);
            const [showTransactionForm, setShowTransactionForm] = useState(false);
            const [showEMIForm, setShowEMIForm] = useState(false);
            const [showGoalForm, setShowGoalForm] = useState(false);
            const [showSimulation, setShowSimulation] = useState(false);
            const [showCSVUpload, setShowCSVUpload] = useState(false);
            const [activeTab, setActiveTab] = useState('dashboard');

            const monthlyIncome = 50000;

            useEffect(() => {
                if (user) {
                    setTransactions(mockApi.getUserTransactions(user.id));
                    setEMIs(mockApi.getUserEMIs(user.id));
                    setGoals(mockApi.getUserGoals(user.id));
                    setNudges(mockApi.getUserNudges(user.id));
                }
            }, [user]);

            useEffect(() => {
                if (user && transactions.length > 0) {
                    const newNudges = generateNudges(user.id, transactions, emis, monthlyIncome);
                    setNudges(newNudges);
                }
            }, [transactions, emis, user, monthlyIncome]);

            const handleAddTransaction = (transactionData) => {
                const newTransaction = mockApi.addTransaction(user.id, transactionData);
                setTransactions(prev => [...prev, newTransaction]);
            };

            const handleAddEMI = (emiData) => {
                const newEMI = mockApi.addEMI(user.id, emiData);
                setEMIs(prev => [...prev, newEMI]);
            };

            const handleAddGoal = (goalData) => {
                const newGoal = mockApi.addGoal(user.id, goalData);
                setGoals(prev => [...prev, newGoal]);
            };

            const handleCSVUpload = (csvTransactions) => {
                csvTransactions.forEach(transaction => {
                    const newTransaction = mockApi.addTransaction(user.id, transaction);
                    setTransactions(prev => [...prev, newTransaction]);
                });
                setShowCSVUpload(false);
            };

            const handleDismissNudge = (nudgeId) => {
                setNudges(prev => prev.filter(n => n.id !== nudgeId));
            };

            const totalExpenses = transactions
                .filter(t => t.amount < 0 && t.category !== 'Investment' && t.category !== 'Transfer')
                .reduce((sum, t) => sum + Math.abs(t.amount), 0);
            
            const totalIncome = transactions
                .filter(t => t.amount > 0 && t.category !== 'Transfer')
                .reduce((sum, t) => sum + t.amount, 0) + monthlyIncome;

            const totalEMI = emis.reduce((sum, e) => sum + e.monthly_emi, 0);
            const savings = totalIncome - totalExpenses - totalEMI;
            const wellnessScore = calculateWellnessScore(transactions, emis, monthlyIncome);

            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="bg-white shadow-sm border-b">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center py-4">
                                <div className="flex items-center">
                                    <h1 className="text-2xl font-bold text-gray-900">FinGuardian</h1>
                                </div>
                                <div className="flex items-center space-x-4">
                                    <span className="text-gray-600">Welcome, {user?.name}</span>
                                    <button
                                        onClick={onLogout}
                                        className="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition"
                                    >
                                        Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="border-b border-gray-200">
                            <nav className="flex space-x-8">
                                {[
                                    { id: 'dashboard', label: 'üìä Dashboard' },
                                    { id: 'transactions', label: 'üí≥ Transactions' },
                                    { id: 'emis', label: 'üè† EMIs' },
                                    { id: 'goals', label: 'üéØ Goals' },
                                    { id: 'simulate', label: 'üîÆ Simulate' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${
                                            activeTab === tab.id
                                                ? 'border-blue-500 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        {tab.label}
                                    </button>
                                ))}
                            </nav>
                        </div>
                    </div>

                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {activeTab === 'dashboard' && (
                            <div className="space-y-8">
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    <StatCard
                                        title="Monthly Income"
                                        value={`‚Çπ${totalIncome.toLocaleString()}`}
                                        subtitle="This month"
                                        icon="üí∞"
                                        color="green"
                                    />
                                    <StatCard
                                        title="Monthly Expenses"
                                        value={`‚Çπ${totalExpenses.toLocaleString()}`}
                                        subtitle="This month"
                                        icon="üí∏"
                                        color="red"
                                    />
                                    <StatCard
                                        title="Monthly Savings"
                                        value={`‚Çπ${Math.max(0, savings).toLocaleString()}`}
                                        subtitle={`${((savings/totalIncome)*100).toFixed(1)}% of income`}
                                        icon="üí≥"
                                        color="blue"
                                    />
                                    <StatCard
                                        title="Wellness Score"
                                        value={`${wellnessScore}/100`}
                                        subtitle={wellnessScore >= 80 ? 'Excellent' : wellnessScore >= 60 ? 'Good' : wellnessScore >= 40 ? 'Fair' : 'Poor'}
                                        icon="‚≠ê"
                                        color={wellnessScore >= 80 ? 'green' : wellnessScore >= 60 ? 'blue' : wellnessScore >= 40 ? 'yellow' : 'red'}
                                    />
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <ExpenseChart transactions={transactions} />
                                    
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-semibold text-gray-800">AI Insights & Nudges</h3>
                                            <span className="text-sm text-gray-500">ü§ñ</span>
                                        </div>
                                        <div className="space-y-3">
                                            {nudges.length > 0 ? (
                                                nudges.map(nudge => (
                                                    <NudgeCard
                                                        key={nudge.id}
                                                        nudge={nudge}
                                                        onDismiss={handleDismissNudge}
                                                    />
                                                ))
                                            ) : (
                                                <div className="text-center py-8 text-gray-500">
                                                    <p>üéâ Great job! No concerns detected.</p>
                                                    <p className="text-sm mt-2">Keep up the good financial habits!</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h3>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <button
                                            onClick={() => setShowTransactionForm(true)}
                                            className="flex flex-col items-center p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition"
                                        >
                                            <span className="text-2xl mb-2">‚ûï</span>
                                            <span className="text-sm font-medium">Add Transaction</span>
                                        </button>
                                        <button
                                            onClick={() => setShowCSVUpload(true)}
                                            className="flex flex-col items-center p-4 bg-green-50 rounded-lg hover:bg-green-100 transition"
                                        >
                                            <span className="text-2xl mb-2">üìÅ</span>
                                            <span className="text-sm font-medium">Upload CSV</span>
                                        </button>
                                        <button
                                            onClick={() => setShowEMIForm(true)}
                                            className="flex flex-col items-center p-4 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition"
                                        >
                                            <span className="text-2xl mb-2">üè†</span>
                                            <span className="text-sm font-medium">Add EMI</span>
                                        </button>
                                        <button
                                            onClick={() => setShowGoalForm(true)}
                                            className="flex flex-col items-center p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition"
                                        >
                                            <span className="text-2xl mb-2">üéØ</span>
                                            <span className="text-sm font-medium">Set Goal</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'transactions' && (
                            <div className="space-y-6">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold text-gray-900">Transactions</h2>
                                    <div className="space-x-3">
                                        <button
                                            onClick={() => setShowCSVUpload(true)}
                                            className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition"
                                        >
                                            Upload CSV
                                        </button>
                                        <button
                                            onClick={() => setShowTransactionForm(true)}
                                            className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                                        >
                                            Add Transaction
                                        </button>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-gray-200">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {transactions.slice(-20).reverse().map((transaction) => (
                                                    <tr key={transaction.id} className="hover:bg-gray-50">
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                            {new Date(transaction.date).toLocaleDateString()}
                                                        </td>
                                                        <td className="px-6 py-4 text-sm text-gray-900">{transaction.description}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap">
                                                            <span className="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
                                                                {transaction.category}
                                                            </span>
                                                        </td>
                                                        <td className={`px-6 py-4 whitespace-nowrap text-sm font-medium ${transaction.amount >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                            {transaction.amount >= 0 ? '+' : ''}‚Çπ{Math.abs(transaction.amount).toLocaleString()}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    {transactions.length === 0 && (
                                        <div className="text-center py-12">
                                            <p className="text-gray-500">No transactions found</p>
                                            <p className="text-sm text-gray-400 mt-2">Add your first transaction or upload a CSV file</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'emis' && (
                            <div className="space-y-6">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold text-gray-900">EMIs & Loans</h2>
                                    <button
                                        onClick={() => setShowEMIForm(true)}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                                    >
                                        Add EMI
                                    </button>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {emis.map((emi) => (
                                        <div key={emi.id} className="bg-white rounded-xl shadow-lg p-6 card-hover">
                                            <div className="flex justify-between items-start mb-4">
                                                <h3 className="text-lg font-semibold text-gray-800">{emi.lender}</h3>
                                                <span className="text-2xl">üè†</span>
                                            </div>
                                            <div className="space-y-3">
                                                <div className="flex justify-between">
                                                    <span className="text-gray-600">Monthly EMI</span>
                                                    <span className="font-semibold">‚Çπ{emi.monthly_emi.toLocaleString()}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-gray-600">Outstanding</span>
                                                    <span className="font-semibold">‚Çπ{emi.outstanding.toLocaleString()}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-gray-600">End Date</span>
                                                    <span className="text-sm">{new Date(emi.end_date).toLocaleDateString()}</span>
                                                </div>
                                                <div className="mt-4 bg-gray-100 rounded-lg h-2">
                                                    <div 
                                                        className="bg-blue-500 h-2 rounded-lg transition-all duration-500"
                                                        style={{ 
                                                            width: `${Math.max(10, 100 - (emi.outstanding / (emi.monthly_emi * 60)) * 100)}%` 
                                                        }}
                                                    ></div>
                                                </div>
                                                <p className="text-xs text-gray-500 text-center">Progress</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                {emis.length === 0 && (
                                    <div className="bg-white rounded-xl shadow-lg p-12 text-center">
                                        <div className="text-6xl mb-4">üè†</div>
                                        <h3 className="text-xl font-semibold text-gray-800 mb-2">No EMIs Added</h3>
                                        <p className="text-gray-600 mb-6">Track your loans and EMIs to get better financial insights</p>
                                        <button
                                            onClick={() => setShowEMIForm(true)}
                                            className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition"
                                        >
                                            Add Your First EMI
                                        </button>
                                    </div>
                                )}

                                {emis.length > 0 && (
                                    <div className="bg-white rounded-xl shadow-lg p-6">
                                        <h3 className="text-lg font-semibold text-gray-800 mb-4">EMI Summary</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                            <div className="text-center">
                                                <p className="text-sm text-gray-600">Total Monthly EMI</p>
                                                <p className="text-2xl font-bold text-gray-900">‚Çπ{totalEMI.toLocaleString()}</p>
                                            </div>
                                            <div className="text-center">
                                                <p className="text-sm text-gray-600">EMI Burden</p>
                                                <p className={`text-2xl font-bold ${(totalEMI/monthlyIncome)*100 > 40 ? 'text-red-600' : 'text-green-600'}`}>
                                                    {((totalEMI/monthlyIncome)*100).toFixed(1)}%
                                                </p>
                                            </div>
                                            <div className="text-center">
                                                <p className="text-sm text-gray-600">Total Outstanding</p>
                                                <p className="text-2xl font-bold text-gray-900">
                                                    ‚Çπ{emis.reduce((sum, e) => sum + e.outstanding, 0).toLocaleString()}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'goals' && (
                            <div className="space-y-6">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold text-gray-900">Financial Goals</h2>
                                    <button
                                        onClick={() => setShowGoalForm(true)}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                                    >
                                        Create Goal
                                    </button>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {goals.map((goal) => {
                                        const progress = Math.min(100, (goal.current_amount / goal.target_amount) * 100);
                                        const remaining = goal.target_amount - goal.current_amount;
                                        const daysLeft = Math.ceil((new Date(goal.target_date) - new Date()) / (1000 * 60 * 60 * 24));
                                        const monthlyRequired = remaining > 0 && daysLeft > 0 ? remaining / (daysLeft / 30) : 0;

                                        return (
                                            <div key={goal.id} className="bg-white rounded-xl shadow-lg p-6 card-hover">
                                                <div className="flex justify-between items-start mb-4">
                                                    <h3 className="text-lg font-semibold text-gray-800">{goal.title}</h3>
                                                    <span className="text-2xl">üéØ</span>
                                                </div>
                                                <div className="space-y-4">
                                                    <div>
                                                        <div className="flex justify-between text-sm mb-2">
                                                            <span>Progress</span>
                                                            <span>{progress.toFixed(1)}%</span>
                                                        </div>
                                                        <div className="bg-gray-200 rounded-full h-3">
                                                            <div 
                                                                className="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500"
                                                                style={{ width: `${progress}%` }}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-4 text-sm">
                                                        <div>
                                                            <p className="text-gray-600">Current</p>
                                                            <p className="font-semibold">‚Çπ{goal.current_amount.toLocaleString()}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-gray-600">Target</p>
                                                            <p className="font-semibold">‚Çπ{goal.target_amount.toLocaleString()}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-gray-600">Days Left</p>
                                                            <p className="font-semibold">{Math.max(0, daysLeft)} days</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-gray-600">Monthly Req.</p>
                                                            <p className="font-semibold">‚Çπ{Math.max(0, monthlyRequired).toLocaleString('en-IN', {maximumFractionDigits: 0})}</p>
                                                        </div>
                                                    </div>
                                                    <div className={`p-3 rounded-lg text-sm ${progress >= 100 ? 'bg-green-100 text-green-800' : daysLeft < 0 ? 'bg-red-100 text-red-800' : monthlyRequired > savings ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800'}`}>
                                                        {progress >= 100 ? 'üéâ Goal achieved!' : 
                                                         daysLeft < 0 ? '‚è∞ Target date passed' :
                                                         monthlyRequired > savings ? '‚ö†Ô∏è Increase monthly savings' :
                                                         '‚úÖ On track'}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {goals.length === 0 && (
                                    <div className="bg-white rounded-xl shadow-lg p-12 text-center">
                                        <div className="text-6xl mb-4">üéØ</div>
                                        <h3 className="text-xl font-semibold text-gray-800 mb-2">No Goals Set</h3>
                                        <p className="text-gray-600 mb-6">Set financial goals to stay motivated and track your progress</p>
                                        <button
                                            onClick={() => setShowGoalForm(true)}
                                            className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition"
                                        >
                                            Create Your First Goal
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'simulate' && (
                            <div className="space-y-6">
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-900 mb-2">Financial Impact Simulator</h2>
                                    <p className="text-gray-600">See how new EMIs or expenses will affect your financial health</p>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg p-8 text-center">
                                    <div className="text-6xl mb-4">üîÆ</div>
                                    <h3 className="text-xl font-semibold text-gray-800 mb-4">EMI Impact Simulator</h3>
                                    <p className="text-gray-600 mb-6">
                                        Planning to take a new loan? See how it will impact your wellness score and monthly budget.
                                    </p>
                                    <button
                                        onClick={() => setShowSimulation(true)}
                                        className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition"
                                    >
                                        Start Simulation
                                    </button>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">Current Financial Health</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                        <div className="text-center">
                                            <p className="text-sm text-gray-600">Monthly Income</p>
                                            <p className="text-xl font-bold text-green-600">‚Çπ{totalIncome.toLocaleString()}</p>
                                        </div>
                                        <div className="text-center">
                                            <p className="text-sm text-gray-600">Total EMI</p>
                                            <p className="text-xl font-bold text-red-600">‚Çπ{totalEMI.toLocaleString()}</p>
                                        </div>
                                        <div className="text-center">
                                            <p className="text-sm text-gray-600">Monthly Expenses</p>
                                            <p className="text-xl font-bold text-orange-600">‚Çπ{totalExpenses.toLocaleString()}</p>
                                        </div>
                                        <div className="text-center">
                                            <p className="text-sm text-gray-600">Wellness Score</p>
                                            <p className={`text-xl font-bold ${wellnessScore >= 80 ? 'text-green-600' : wellnessScore >= 60 ? 'text-blue-600' : wellnessScore >= 40 ? 'text-yellow-600' : 'text-red-600'}`}>
                                                {wellnessScore}/100
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {showTransactionForm && (
                        <TransactionForm
                            onSubmit={handleAddTransaction}
                            onClose={() => setShowTransactionForm(false)}
                        />
                    )}

                    {showEMIForm && (
                        <EMIForm
                            onSubmit={handleAddEMI}
                            onClose={() => setShowEMIForm(false)}
                        />
                    )}

                    {showGoalForm && (
                        <GoalForm
                            onSubmit={handleAddGoal}
                            onClose={() => setShowGoalForm(false)}
                        />
                    )}

                    {showSimulation && (
                        <SimulationModal
                            onClose={() => setShowSimulation(false)}
                            currentIncome={monthlyIncome}
                            transactions={transactions}
                            emis={emis}
                        />
                    )}

                    {showCSVUpload && (
                        <CSVUpload
                            onUpload={handleCSVUpload}
                            onClose={() => setShowCSVUpload(false)}
                        />
                    )}
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const { user, login, register, logout } = useAuth();
            const [authMode, setAuthMode] = useState('login');

            useEffect(() => {
                if (mockApi.users.length === 0) {
                    mockApi.register('Demo User', 'demo@finguardian.com', 'demo123');
                    
                    const demoUserId = mockApi.users[0].id;
                    const demoTransactions = [
                        { date: '2024-01-15', description: 'Salary Credit', amount: 50000, category: 'Income' },
                        { date: '2024-01-16', description: 'Zomato Order', amount: -450, category: 'Food & Dining' },
                        { date: '2024-01-17', description: 'Uber Ride', amount: -280, category: 'Transportation' },
                        { date: '2024-01-18', description: 'Amazon Purchase', amount: -1200, category: 'Shopping' },
                        { date: '2024-01-19', description: 'Electricity Bill', amount: -1800, category: 'Bills & Utilities' },
                        { date: '2024-01-20', description: 'Netflix Subscription', amount: -199, category: 'Entertainment' },
                        { date: '2024-01-21', description: 'Swiggy Order', amount: -680, category: 'Food & Dining' },
                        { date: '2024-01-22', description: 'Petrol Pump', amount: -2000, category: 'Transportation' },
                        { date: '2024-01-23', description: 'Medical Store', amount: -350, category: 'Healthcare' },
                        { date: '2024-01-24', description: 'SIP Investment', amount: -5000, category: 'Investment' }
                    ];
                    
                    demoTransactions.forEach(t => mockApi.addTransaction(demoUserId, t));
                    
                    mockApi.addEMI(demoUserId, {
                        lender: 'Home Loan - HDFC',
                        monthly_emi: 15000,
                        start_date: '2023-06-01',
                        end_date: '2043-06-01',
                        outstanding: 2500000
                    });
                    
                    mockApi.addEMI(demoUserId, {
                        lender: 'Car Loan - ICICI',
                        monthly_emi: 8500,
                        start_date: '2023-12-01',
                        end_date: '2028-12-01',
                        outstanding: 350000
                    });
                    
                    mockApi.addGoal(demoUserId, {
                        title: 'Emergency Fund',
                        target_amount: 300000,
                        current_amount: 75000,
                        target_date: '2024-12-31'
                    });
                    
                    mockApi.addGoal(demoUserId, {
                        title: 'Vacation to Europe',
                        target_amount: 150000,
                        current_amount: 25000,
                        target_date: '2024-08-15'
                    });
                }
            }, []);

            if (!user) {
                return authMode === 'login' ? (
                    <Login 
                        onLogin={login} 
                        onSwitchToRegister={() => setAuthMode('register')} 
                    />
                ) : (
                    <Register 
                        onRegister={register} 
                        onSwitchToLogin={() => setAuthMode('login')} 
                    />
                );
            }

            return <Dashboard user={user} onLogout={logout} />;
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
